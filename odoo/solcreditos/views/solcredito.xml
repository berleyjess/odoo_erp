<!-- solcreditos-views-solcredito.xml -->
<odoo>
    <!-- Acción de Menú (DEBE IR PRIMERO) -->
    <record id="action_asignaciones" model="ir.actions.act_window">
        <field name="name">Asignaciones</field>
        <field name="res_model">solcreditos.solcredito</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Crea tu primer asignacion</p>
        </field>
    </record>

    <!-- Vista árbol -->
    <record id="view_asignacion_list" model="ir.ui.view">
        <field name="name">asignacion.tree</field>
        <field name="model">solcreditos.solcredito</field>
        <field name="arch" type="xml">
            <list>
                <field name="cliente"/>
                <field name="contrato"/>
            </list>
        </field>
    </record>

    <!-- Vista formulario -->
    <record id="view_asignacion_form" model="ir.ui.view">
        <field name="name">asignacion.form</field>
        <field name="model">solcreditos.solcredito</field>
        <field name="arch" type="xml">
            <form autosave="False">
                <sheet>
                    <group>
                        <field name="cliente"/>
                        <field name="cliente_nombre" readonly="1"/>
                        <field name="ciclo"/>
                        <field name="contrato"/>
                        <field name="titularr" widget="radio" options="{'horizontal': true}" readonly="not cliente or not contrato"/>
                        <field name="monto" readonly="not cliente or not contrato"/>
                        <div class="text-muted" invisible="not contrato">
                            <span invisible="contrato.tipocredito == '2'">
                                Cálculo automático: Aporte × Superficie
                            </span>
                            <span invisible="contrato.tipocredito != '2'">
                                Monto manual (Crédito Especial)
                            </span>
                        </div>
                        <field name="vencimiento" readonly="not cliente or not contrato"/>
                        <field name="superficie" readonly="contrato.tipocredito != '1'" invisible="contrato.tipocredito == '2'" />
                    </group>
                    <group name="datos_obligado" string="Obligado Solidario">
                        <div class="o_row" invisible="not cliente">
                            <field name="cliente_estado_civil" readonly="1"/>
                            <field name="cliente_conyugue" readonly="1" invisible="cliente_estado_civil not in ['casado', 'union_libre']"/>
                        </div>
                        <field name="obligado" readonly="not cliente or not contrato"/>
                        <field name="obligadodomicilio" readonly="not cliente or not contrato"/>
                        <field name="obligadoRFC" readonly="not cliente or not contrato"/>
                    </group>
                    <group>
                        <field name="predios" widget="one2many_list" context="{'default_solcredito_id': id}"
                        invisible = "contrato.tipocredito != '0'" readonly="not cliente or not contrato"/>
                    </group>

                    <group>
                        <span>Total garantías: </span>
                        <field name="total_garantias" readonly="1" widget="monetary"/>
                        <span> / Monto crédito: </span>
                        <field name="monto" readonly="1" widget="monetary" nolabel="1"/>
                    </group>

                    <group name="garantias" string="Garantías" invisible="tipocredito_val != '0'">
                        <div class="o_row">
                            <field name="garantias" readonly="not cliente or not contrato">
                                <list editable="bottom">
                                    <field name="es_dueno_garantia" string="¿Es dueño?" width="90px"/>
                                    <field name="tipo" width="120px"/>
                                    <field name="titular" width="150px" readonly="es_dueno_garantia == 'si'"/>
                                    <field name="valor" string="Valor" width="100px"/>
                                    <field name="descripcion" width="200px"/>
                                    <field name="fecha_entrega" string="F. Entrega" width="100px"/>
                                    <field name="persona_entrega" string="Entrega" width="120px"/>
                                    <field name="persona_recibe" string="Recibe" width="120px"/>
                                </list>
                            </field>
                        </div>
                    </group>

                    <group name="predios" string="Predios" invisible="tipocredito_val != '0'">
                        <field name="predios" readonly="not cliente or not contrato">
                            <list editable="bottom">
                                <field name="es_dueno_predio" string="¿Es dueño?" width="80px"/>
                                <field name="titular" width="150px" placeholder="Nombre del titular (si no es dueño)" readonly="es_dueno_predio == 'si'"/>
                                <field name="localidad" width="120px"/>
                                <field name="superficie" string="Superficie Total" width="100px"/>
                                <field name="superficiecultivable" string="Cultivable" width="90px"/>
                                <field name="nocertificado" width="120px"/>
                                <field name="colnorte" width="90px"/>
                                <field name="colsur" width="90px"/>
                                <field name="coleste" width="90px"/>
                                <field name="coloeste" width="90px"/>
                                <!-- Aquí podrías agregar georeferencias como smart button o vista aparte -->
                            </list>
                        </field>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Menús -->
    <menuitem id="menu_root" name="Solicitudes de Créditos" sequence="10"/>
    <menuitem id="menu_action" name="Catálogo de Solicitudes" parent="menu_root" action="action_asignaciones"/>
</odoo>