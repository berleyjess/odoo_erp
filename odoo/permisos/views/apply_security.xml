<!-- permisos/views/apply_security.xml -->
<odoo>
    <record id="view_perm_apply_security_wiz" model="ir.ui.view">
        <field name="name">permisos.apply.security.wiz.form</field>
        <field name="model">permisos.apply.security.wiz</field>
        <field name="arch" type="xml">
          <form string="Aplicar seguridad">
            <group>
              <field name="include_all_modules"/>
            </group>
            <footer>
              <button string="Aplicar" type="object" name="action_apply" class="btn-primary"/>
              <button string="Cerrar" special="cancel" class="btn-secondary"/>
            </footer>
          </form>
        </field>
    </record>

    <record id="action_perm_apply_security" model="ir.actions.act_window">
        <field name="name">Aplicar seguridad</field>
        <field name="res_model">permisos.apply.security.wiz</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <record id="view_permisos_modulo_form_inherit_apply_button" model="ir.ui.view">
      <field name="name">permisos.modulo.form.apply.button</field>
      <field name="model">permisos.modulo</field>
      <field name="inherit_id" ref="permisos.view_permisos_modulo_form"/>
      <field name="arch" type="xml">
        <!-- Inserta el header dentro del form -->
        <xpath expr="//form" position="inside">
          <header>
            <!-- Campo usado en la condición; invisible para el usuario -->
            <group>
              <field name="dirty" invisible="1"/>
              <separator string=""/>
              <!-- Botón de aplicar: visible SOLO si dirty = True -->
              <button name="%(action_perm_apply_security)d"
                      type="action"
                      string="Aplicar seguridad"
                      class="oe_highlight"
                      icon="fa-shield"
                      invisible="dirty == False"/>
            </group>
          </header>
        </xpath>
      </field>
    </record>


</odoo>
