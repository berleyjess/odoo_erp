<?xml version="1.0" encoding="UTF-8"?>
<odoo>
<!--permisos/views/permisos_wizard_views.xml-->
  <!-- Acción del Wizard -->
  <record id="action_permisos_efectivo_wiz" model="ir.actions.act_window">
    <field name="name">Permisos del Usuario</field>
    <field name="res_model">permisos.efectivo.wiz</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
    <field name="context">{}</field>
  </record>

  <!-- Vista del Wizard -->
  <record id="view_permisos_efectivo_wiz_form" model="ir.ui.view">
    <field name="name">permisos.efectivo.wiz.form</field>
    <field name="model">permisos.efectivo.wiz</field>
    <field name="arch" type="xml">
      <form string="Permisos efectivos">
        <sheet>
          <group>
            <field name="usuario_id"/>
            <field name="empresa_id"/>

            <field name="sucursal_id"
                    domain="[('empresa', '=', empresa_id)]"
                    invisible="[('empresa_id','=',False)]"/>
            
            <field name="bodega_id"
                    domain="[('empresa_id', '=', empresa_id)]"
                    invisible="[('empresa_id','=',False)]"/>



          </group>

          <group>
            <button string="Recalcular" type="object" name="action_rebuild_lines" class="btn-primary"/>
          </group>

          <group>
            <field name="line_ids" create="0" delete="0" context="{'from_wiz': True}">
                <list editable="bottom">
                  <field name="seleccionar"/>
                  <field name="modulo_code"/>
                  <field name="permiso_code"/>
                  <field name="permiso_name"/>
                  <field name="allowed"/>
                  <field name="override_state"/>
                  <field name="permiso_id" invisible="1"/>
                </list>
            </field>
          </group>
        </sheet>
        <footer>
          <button string="Permitir seleccionados" type="object" name="action_allow_selected" class="btn-primary"/>
          <button string="Denegar seleccionados" type="object" name="action_deny_selected" class="btn-secondary"/>
          <button string="Quitar overrides seleccionados" type="object" name="action_clear_selected" class="btn-secondary"/>
          <button string="Cerrar" class="btn-link" special="cancel"/>
        </footer>
      </form>
    </field>
  </record>

  <!-- Botón en Usuarios para abrir el Wizard -->
  <record id="view_users_form_inherit_permisos_buttons" model="ir.ui.view">
      <field name="name">res.users.form.permisos.buttons</field>
      <field name="model">res.users</field>
      <field name="inherit_id" ref="base.view_users_form"/>
      <field name="arch" type="xml">
          <xpath expr="//form/header" position="inside">
              <button name="action_open_permisos_wizard"
                      string="Permisos"
                      type="object"
                      class="oe_stat_button"
                      groups="base.group_system"/>
          </xpath>
      </field>
  </record>
</odoo>
