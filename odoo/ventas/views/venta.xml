<odoo>

    <!-- =============================
         ACCIÓN PRINCIPAL (Lista + Form Detalle)
         ============================= -->
    <record id="action_ventas" model="ir.actions.act_window">
        <field name="name">Ventas</field>
        <field name="res_model">ventas.venta</field>
        <field name="view_mode">list,form</field>
        <!-- Oculta botón "Crear" en la acción principal -->
        <field name="context">{'create': False}</field>
        <field name="target">current</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Crea tu primera venta</p>
        </field>
    </record>

    <!-- =============================
         LISTA (árbol)
         ============================= -->
    <record id="view_venta_list" model="ir.ui.view">
        <field name="name">venta.list</field>
        <field name="model">ventas.venta</field>
        <field name="arch" type="xml">
            <list string="Ventas">
                <field name="fecha"/>
                <field name="cliente"/>
                <field name="contrato"/>
                <field name="sucursal_id"/>
                <field name="codigo"/>
                <field name="state"/>
            </list>
        </field>
    </record>

    <!-- =============================
         FORM EDITABLE
         ============================= -->
    <record id="view_venta_form" model="ir.ui.view">
        <field name="name">venta.form</field>
        <field name="model">ventas.venta</field>
        <field name="arch" type="xml">
            <form string="Ventas">
                <header>
                    <!-- Botón Volver a la lista -->
                    <button name="%(ventas.action_ventas)d" type="action" string="Volver" class="btn-secondary"/>
                </header>

                <sheet>
                    <group>
                        <field name="fecha"/>
                        <field name="cliente"/>
                        <field name="sucursal_id"/>
                        <field name="codigo" readonly="1"/>
                        <field name="state" readonly="1"/>

                        <field name="metododepago" widget="radio" options="{'horizontal': true}"/>

                        <!-- Solo si PUE -->
                        <field name="formadepago"
                               required="metododepago == 'PUE'"
                               invisible="metododepago != 'PUE'"/>

                        <!-- Si NO es PUE (PPD/Crédito) -->
                        <field name="contrato"
                               required="metododepago != 'PUE'"
                               invisible="metododepago == 'PUE'"/>

                        <field name="observaciones"/>
                    </group>

                    <notebook>
                        <page string="Detalles de Venta">
                            <field name="detalle" widget="one2many_list">
                                <list editable="bottom">
                                    <field name="producto_id"/>
                                    <field name="cantidad"/>
                                    <field name="precio"/>
                                    <field name="iva"/>
                                    <field name="ieps"/>
                                    <field name="importe"/>
                                </list>
                            </field>
                        </page>
                    </notebook>

                    <group string="Totales">
                        <field name="importe"/>
                        <field name="iva"/>
                        <field name="ieps"/>
                        <field name="total"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- =============================
         FORM SOLO LECTURA (DETALLE)
         ============================= -->
    <record id="view_venta_form_detalle" model="ir.ui.view">
        <field name="name">venta.form.detalle</field>
        <field name="model">ventas.venta</field>
        <field name="arch" type="xml">
            <form string="Ventas" edit="false" create="false" delete="false">
                <header>
                    <!-- Abrir el mismo registro en la vista EDIT -->
                    <button name="action_open_edit" type="object" string="Editar"
                            class="btn-primary"
                            confirm="¿Estás seguro que quieres editar el registro?"/>
                    <button name="%(ventas.action_ventas)d" type="action" string="Volver" class="btn-secondary"/>
                </header>

                <sheet>
                    <group>
                        <field name="fecha" readonly="1"/>
                        <field name="cliente" readonly="1" options="{'no_open': True}"/>
                        <field name="sucursal_id" readonly="1" options="{'no_open': True}"/>
                        <field name="codigo" readonly="1"/>
                        <field name="state" readonly="1"/>

                        <field name="metododepago" readonly="1" widget="radio" options="{'horizontal': true}"/>

                        <!-- Mostrar condicionados pero siempre readonly -->
                        <field name="formadepago" readonly="1" invisible="metododepago != 'PUE'"/>
                        <field name="contrato" readonly="1" invisible="metododepago == 'PUE'" options="{'no_open': True}"/>

                        <field name="observaciones" readonly="1"/>
                    </group>

                    <!-- One2many bloqueado con opciones (sin usar editable="false") -->
                    <field name="detalle"
                           widget="one2many_list"
                           readonly="1"
                           options="{'no_create': True, 'no_edit': True, 'no_open': True, 'no_create_edit': True}">
                        <list string="Detalles de Venta">
                            <field name="producto_id" readonly="1"/>
                            <field name="cantidad" readonly="1"/>
                            <field name="precio" readonly="1"/>
                            <field name="iva" readonly="1"/>
                            <field name="ieps" readonly="1"/>
                            <field name="importe" readonly="1"/>
                        </list>
                    </field>

                    <group string="Totales">
                        <field name="importe" readonly="1"/>
                        <field name="iva" readonly="1"/>
                        <field name="ieps" readonly="1"/>
                        <field name="total" readonly="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- =============================
         BINDINGS: forzar que el FORM por defecto sea el DETALLE
         ============================= -->
    <record id="action_ventas_list_view" model="ir.actions.act_window.view">
        <field name="sequence" eval="10"/>
        <field name="view_mode">list</field>
        <field name="view_id" ref="view_venta_list"/>
        <field name="act_window_id" ref="action_ventas"/>
    </record>

    <record id="action_ventas_form_detalle" model="ir.actions.act_window.view">
        <field name="sequence" eval="20"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_venta_form_detalle"/>
        <field name="act_window_id" ref="action_ventas"/>
    </record>

    <!-- =============================
         ACCIÓN "NUEVA VENTA" (abre la vista EDIT directamente)
         ============================= -->
    <record id="action_ventas_new" model="ir.actions.act_window">
        <field name="name">Nueva venta</field>
        <field name="res_model">ventas.venta</field>
        <field name="view_mode">form</field>
        <field name="context">{'form_view_initial_mode': 'edit'}</field>
        <field name="target">current</field>
    </record>

    <record id="action_ventas_new_form" model="ir.actions.act_window.view">
        <field name="sequence" eval="10"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_venta_form"/>
        <field name="act_window_id" ref="action_ventas_new"/>
    </record>

    <!-- =============================
         MENÚS
         ============================= -->
    <menuitem id="menu_root" name="Ventas" sequence="10"/>
    <menuitem id="menu_action" name="Listado de Ventas" parent="menu_root" action="action_ventas"/>
    <menuitem id="menu_action_new" name="Nueva venta" parent="menu_root" action="action_ventas_new"/>

</odoo>

